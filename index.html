<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>彈力兔 RoboBunny - 採草莓任務</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>
    <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    <script src="https://unpkg.com/blockly/msg/zh-hant.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>🐰 彈力兔 RoboBunny</h1>
            <nav class="nav-tabs">
                <button class="tab-btn active" data-tab="designer">🗺️ 地圖設計</button>
                <button class="tab-btn" data-tab="game">🎮 開始遊戲</button>
            </nav>
        </header>

        <!-- Map Designer Tab -->
        <section id="designer-tab" class="tab-content active">
            <div class="designer-layout">
                <!-- Toolbar -->
                <div class="toolbar">
                    <h3>🎨 繪製工具</h3>
                    <div class="tool-group">
                        <button class="tool-btn active" data-tool="cycle" title="點擊切換">
                            <span class="tool-icon">👆</span>
                            <span>智慧切換</span>
                        </button>
                        <button class="tool-btn" data-tool="empty" title="空地">
                            <span class="tool-icon">🟩</span>
                            <span>空地</span>
                        </button>
                        <button class="tool-btn" data-tool="strawberry" title="草莓">
                            <span class="tool-icon">🍓</span>
                            <span>草莓</span>
                        </button>
                        <button class="tool-btn" data-tool="stone" title="石頭">
                            <span class="tool-icon">🪨</span>
                            <span>石頭</span>
                        </button>
                        <button class="tool-btn" data-tool="puddle" title="水坑">
                            <span class="tool-icon">💧</span>
                            <span>水坑</span>
                        </button>
                        <button class="tool-btn" data-tool="bunny" title="兔子起點">
                            <span class="tool-icon">🐰</span>
                            <span>兔子 1</span>
                        </button>
                        <button class="tool-btn" data-tool="bunny2" title="兔子2起點">
                            <span class="tool-icon">🐰</span>
                            <span>兔子 2</span>
                        </button>
                    </div>

                    <div class="strawberry-count" id="strawberry-options" style="display:none;">
                        <label>草莓數量：</label>
                        <div class="count-btns">
                            <button class="count-btn active" data-count="1">1</button>
                            <button class="count-btn" data-count="2">2</button>
                            <button class="count-btn" data-count="3">3</button>
                            <button class="count-btn" data-count="4">4</button>
                            <button class="count-btn" data-count="5">5</button>
                            <button class="count-btn" data-count="6">6</button>
                            <button class="count-btn" data-count="7">7</button>
                            <button class="count-btn" data-count="8">8</button>
                            <button class="count-btn" data-count="9">9</button>
                        </div>
                    </div>

                    <div class="bunny-direction" id="direction-options" style="display:none;">
                        <label>兔子方向：</label>
                        <div class="direction-btns">
                            <button class="dir-btn active" data-dir="up">⬆️ 上</button>
                            <button class="dir-btn" data-dir="right">➡️ 右</button>
                            <button class="dir-btn" data-dir="down">⬇️ 下</button>
                            <button class="dir-btn" data-dir="left">⬅️ 左</button>
                        </div>
                    </div>

                    <div class="puzzle-settings">
                        <label>積木數量限制：</label>
                        <input type="number" id="block-limit-input" min="5" max="50" value="20" class="limit-input">
                    </div>

                    <div class="tool-actions">
                        <button class="action-btn" id="clear-map">🗑️ 清空地圖</button>
                        <button class="action-btn" id="save-map">💾 儲存地圖</button>
                        <button class="action-btn" id="load-map">📂 載入檔案</button>
                        <button class="action-btn" id="export-map">📤 匯出檔案</button>
                    </div>

                    <div class="saved-maps">
                        <h4>已儲存地圖</h4>
                        <div id="map-list"></div>
                    </div>
                </div>

                <!-- Grid Canvas -->
                <div class="grid-container">
                    <div class="grid" id="designer-grid"></div>
                    <div class="grid-info">
                        <span>地圖大小：21 × 21</span>
                        <span id="total-strawberries">總草莓數：0</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Game Tab -->
        <section id="game-tab" class="tab-content">
            <div class="game-layout">
                <!-- Block Editor -->
                <div class="block-editor">
                    <h3>🧩 程式積木</h3>

                    <div class="bunny-tabs" id="bunny-tabs" style="display: none;">
                        <button class="bunny-tab active" data-bunny="1">🐰 兔子 1</button>
                        <button class="bunny-tab" data-bunny="2">🐰 兔子 2</button>
                    </div>

                    <div id="blocklyDiv" style="height: 600px; width: 100%;"></div>
                </div>
                <xml id="toolbox" style="display: none">
                    <category name="移動指令" colour="#5b80a5">
                        <block type="F_Jump"></block>
                        <block type="FR_Jump"></block>
                        <block type="FL_Jump"></block>
                    </category>
                    <category name="轉向指令" colour="#5ba55b">
                        <block type="Turn"></block>
                    </category>
                    <category name="控制" colour="#a55b80">
                        <block type="controls_repeat_ext">
                            <value name="TIMES">
                                <shadow type="math_number">
                                    <field name="NUM">2</field>
                                </shadow>
                            </value>
                        </block>
                    </category>
                </xml>
            </div>

            <!-- Game Grid -->
            <div class="game-container">
                <div class="game-header">
                    <div class="bunny-stats" id="bunny1-stats">
                        <span class="bunny-label">
                            🐰
                            <span class="bunny-badge header-badge">1</span>
                        </span>
                        <div class="score-display">
                            <span class="score-icon">🍓</span>
                            <span class="score-value" id="score1">0</span>
                        </div>
                        <div class="score-display move-display">
                            <span class="score-icon">👣</span>
                            <span class="score-value" id="move-count1">0</span>
                        </div>
                    </div>
                    <div class="bunny-stats" id="bunny2-stats" style="display: none;">
                        <span class="bunny-label">
                            🐰
                            <span class="bunny-badge header-badge">2</span>
                        </span>
                        <div class="score-display">
                            <span class="score-icon">🍓</span>
                            <span class="score-value" id="score2">0</span>
                        </div>
                        <div class="score-display move-display">
                            <span class="score-icon">👣</span>
                            <span class="score-value" id="move-count2">0</span>
                        </div>
                    </div>
                    <div class="game-status" id="game-status">準備開始</div>
                </div>

                <div class="grid" id="game-grid"></div>

                <div class="game-controls">
                    <select id="map-selector" class="map-select">
                        <option value="">-- 選擇地圖 --</option>
                    </select>
                    <button class="control-btn" id="run-btn">▶️ 執行</button>
                    <button class="control-btn" id="step-btn">⏭️ 單步</button>
                    <button class="control-btn" id="reset-btn">🔄 重置</button>
                </div>
            </div>
    </div>
    </section>
    </div>

    <script src="map-designer.js"></script>
    <script src="game-engine.js"></script>
    <script src="block-editor.js"></script>
    <script src="app.js"></script>
</body>

</html>